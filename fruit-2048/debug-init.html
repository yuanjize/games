<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è°ƒè¯•æ°´æœæ¸¸æˆåˆå§‹åŒ–</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #0f172a;
            color: white;
        }
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 12px;
            background: rgba(15, 23, 42, 0.5);
            padding: 12px;
            border-radius: 1rem;
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }
        .grid-cell {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .grid-cell.has-fruit {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .debug-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 8px;
        }
        button:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <h1>æ°´æœæ¸¸æˆåˆå§‹åŒ–è°ƒè¯•</h1>

    <div class="debug-info">
        <h3>è°ƒè¯•ä¿¡æ¯</h3>
        <div id="debug-output">åˆå§‹åŒ–ä¸­...</div>
    </div>

    <div style="text-align: center;">
        <button onclick="testManualInit()">æ‰‹åŠ¨åˆå§‹åŒ–æ¸¸æˆ</button>
        <button onclick="testDirectRender()">ç›´æ¥æ¸²æŸ“æµ‹è¯•</button>
        <button onclick="clearBoard()">æ¸…ç©ºæ£‹ç›˜</button>
    </div>

    <div id="game-board"></div>

    <div class="debug-info">
        <h3>ç½‘æ ¼çŠ¶æ€</h3>
        <pre id="grid-state">æš‚æ— æ•°æ®</pre>
    </div>

    <script src="game.js"></script>
    <script>
        const debugOutput = document.getElementById('debug-output');
        const gridState = document.getElementById('grid-state');
        let gameInstance = null;

        function log(msg) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<div>[${timestamp}] ${msg}</div>`;
            console.log(`[DEBUG] ${msg}`);
        }

        // ç›‘å¬DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            log('âœ“ DOMContentLoaded äº‹ä»¶è§¦å‘');

            // æ£€æŸ¥game-boardå…ƒç´ 
            const board = document.getElementById('game-board');
            if (board) {
                log(`âœ“ æ‰¾åˆ° game-board å…ƒç´ `);
                log(`  - å®½åº¦: ${board.offsetWidth}px`);
                log(`  - é«˜åº¦: ${board.offsetHeight}px`);
            } else {
                log('âœ— æœªæ‰¾åˆ° game-board å…ƒç´ ï¼');
            }

            // ç­‰å¾…ä¸€ä¸‹è®©æ¸¸æˆåˆå§‹åŒ–
            setTimeout(() => {
                if (window.game) {
                    gameInstance = window.game;
                    log('âœ“ æ¸¸æˆå®ä¾‹å·²åˆ›å»º');
                    log(`  - Gridå¤§å°: ${gameInstance.gridSize}`);
                    log(`  - åˆ†æ•°: ${gameInstance.score}`);
                    log(`  - æ¸¸æˆç»“æŸ: ${gameInstance.gameOver}`);

                    // æ£€æŸ¥ç½‘æ ¼å†…å®¹
                    let fruitCount = 0;
                    for(let r = 0; r < gameInstance.gridSize; r++) {
                        for(let c = 0; c < gameInstance.gridSize; c++) {
                            if(gameInstance.grid[r][c]) {
                                fruitCount++;
                                log(`  - æ°´æœ[${r}][${c}]: ${gameInstance.grid[r][c].emoji}`);
                            }
                        }
                    }
                    log(`  - æ€»æ°´æœæ•°: ${fruitCount}`);

                    // æ›´æ–°ç½‘æ ¼çŠ¶æ€æ˜¾ç¤º
                    updateGridState();
                } else {
                    log('âœ— æ¸¸æˆå®ä¾‹æœªåˆ›å»ºï¼');
                }
            }, 500);
        });

        function updateGridState() {
            if (!gameInstance) {
                gridState.textContent = 'æ¸¸æˆå®ä¾‹ä¸å­˜åœ¨';
                return;
            }

            let state = '';
            for(let r = 0; r < gameInstance.gridSize; r++) {
                for(let c = 0; c < gameInstance.gridSize; c++) {
                    const cell = gameInstance.grid[r][c];
                    state += cell ? `[${cell.emoji}] ` : '[   ] ';
                }
                state += '\n';
            }
            gridState.textContent = state;
        }

        function testManualInit() {
            log('--- æ‰‹åŠ¨åˆå§‹åŒ–æµ‹è¯• ---');
            try {
                // é‡æ–°åˆ›å»ºæ¸¸æˆå®ä¾‹
                window.game = new FruitGame();
                gameInstance = window.game;
                log('âœ“ æ‰‹åŠ¨åˆå§‹åŒ–æˆåŠŸ');
                updateGridState();
            } catch(e) {
                log(`âœ— åˆå§‹åŒ–å¤±è´¥: ${e.message}`);
                console.error(e);
            }
        }

        function testDirectRender() {
            log('--- ç›´æ¥æ¸²æŸ“æµ‹è¯• ---');
            const board = document.getElementById('game-board');

            if (!board) {
                log('âœ— æœªæ‰¾åˆ° game-board å…ƒç´ ');
                return;
            }

            // æ¸…ç©ºå¹¶ç›´æ¥åˆ›å»ºä¸€äº›æµ‹è¯•æ ¼å­
            board.innerHTML = '';

            const testFruits = ['ğŸ', 'ğŸŠ', 'ğŸ‡', 'ğŸ“', 'ğŸ‰', 'ğŸ', 'ğŸ¥­', 'ğŸ¥'];

            for(let i = 0; i < 16; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';

                // æ¯éš”ä¸€ä¸ªæ ¼å­æ”¾ä¸€ä¸ªæ°´æœ
                if (i % 2 === 0) {
                    cell.textContent = testFruits[i % testFruits.length];
                    cell.classList.add('has-fruit');
                }

                board.appendChild(cell);
            }

            log(`âœ“ ç›´æ¥åˆ›å»ºäº† 16 ä¸ªæ ¼å­`);
            log(`  - Boardå­å…ƒç´ æ•°: ${board.children.length}`);

            // æ£€æŸ¥ç¬¬ä¸€ä¸ªæ ¼å­
            if (board.children[0]) {
                const firstCell = board.children[0];
                log(`  - ç¬¬ä¸€ä¸ªæ ¼å­å†…å®¹: "${firstCell.textContent}"`);
                log(`  - ç¬¬ä¸€ä¸ªæ ¼å­ç±»å: ${firstCell.className}`);
                log(`  - ç¬¬ä¸€ä¸ªæ ¼å­å­—ä½“å¤§å°: ${getComputedStyle(firstCell).fontSize}`);
            }
        }

        function clearBoard() {
            const board = document.getElementById('game-board');
            if (board) {
                board.innerHTML = '';
                log('âœ“ æ£‹ç›˜å·²æ¸…ç©º');
            }
        }
    </script>
</body>
</html>
