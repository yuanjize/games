<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æœ2048 - è°ƒè¯•ç‰ˆæœ¬</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* è°ƒè¯•æ ·å¼ */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 300px;
            max-height: 400px;
            overflow: auto;
        }
        .debug-info h3 {
            margin: 0 0 10px 0;
            color: #ff0;
        }
        .debug-item {
            margin: 5px 0;
        }
        .debug-error {
            color: #f00;
        }
        .debug-success {
            color: #0f0;
        }
        .grid-cell {
            border: 1px solid rgba(255,255,255,0.3) !important;
        }
        .grid-cell.has-fruit {
            border: 2px solid #0f0 !important;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debug-info">
        <h3>è°ƒè¯•ä¿¡æ¯</h3>
        <div id="debug-log"></div>
    </div>

    <div class="container" role="main">
        <header>
            <h1>æ°´æœ2048 - è°ƒè¯•ç‰ˆ</h1>
            <p class="subtitle">æ­£åœ¨è¯Šæ–­é—®é¢˜...</p>
        </header>

        <main>
            <div class="game-header">
                <div class="score-container">
                    <div class="score-box">
                        <div class="score-label">å½“å‰åˆ†æ•°</div>
                        <div class="score-value" id="current-score">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">æœ€é«˜åˆ†æ•°</div>
                        <div class="score-value" id="best-score">0</div>
                    </div>
                </div>

                <div class="game-controls">
                    <button class="btn" id="restart-btn">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                    <button class="btn" id="test-btn">
                        <i class="fas fa-bug"></i> æµ‹è¯•æ¸²æŸ“
                    </button>
                </div>
            </div>

            <div class="game-board-container">
                <div class="game-board" id="game-board" role="application">
                    <!-- 4x4ç½‘æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </main>
    </div>

    <script src="game.js"></script>
    <script>
        // è°ƒè¯•è„šæœ¬
        const debugLog = document.getElementById('debug-log');

        function addDebug(message, type = 'info') {
            const item = document.createElement('div');
            item.className = 'debug-item';
            if (type === 'error') item.classList.add('debug-error');
            if (type === 'success') item.classList.add('debug-success');
            item.textContent = message;
            debugLog.appendChild(item);
            console.log(`[DEBUG] ${message}`);
        }

        // ç­‰å¾…DOMåŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            addDebug('DOMå·²åŠ è½½', 'success');

            // æ£€æŸ¥å…³é”®å…ƒç´ 
            const board = document.getElementById('game-board');
            if (board) {
                addDebug('æ¸¸æˆæ¿å…ƒç´ å­˜åœ¨', 'success');
                addDebug(`æ¸¸æˆæ¿å°ºå¯¸: ${board.offsetWidth}x${board.offsetHeight}`);
            } else {
                addDebug('æ¸¸æˆæ¿å…ƒç´ ä¸å­˜åœ¨!', 'error');
            }

            const scoreEl = document.getElementById('current-score');
            if (scoreEl) {
                addDebug('åˆ†æ•°å…ƒç´ å­˜åœ¨', 'success');
            } else {
                addDebug('åˆ†æ•°å…ƒç´ ä¸å­˜åœ¨!', 'error');
            }

            // ç›‘å¬æ¸¸æˆåˆå§‹åŒ–
            setTimeout(() => {
                if (window.game) {
                    addDebug('æ¸¸æˆå¯¹è±¡å·²åˆ›å»º', 'success');
                    addDebug(`ç½‘æ ¼å¤§å°: ${window.game.gridSize}x${window.game.gridSize}`);
                    addDebug(`å½“å‰åˆ†æ•°: ${window.game.score}`);

                    // æ£€æŸ¥ç½‘æ ¼å†…å®¹
                    if (window.game.grid) {
                        let fruitCount = 0;
                        for (let r = 0; r < window.game.gridSize; r++) {
                            for (let c = 0; c < window.game.gridSize; c++) {
                                if (window.game.grid[r][c]) {
                                    fruitCount++;
                                }
                            }
                        }
                        addDebug(`ç½‘æ ¼ä¸­çš„æ°´æœæ•°é‡: ${fruitCount}`, 'success');
                    }

                    // æ£€æŸ¥æ¸²æŸ“ç»“æœ
                    const cells = board.querySelectorAll('.grid-cell');
                    addDebug(`æ¸²æŸ“çš„æ ¼å­æ•°é‡: ${cells.length}`, cells.length === 16 ? 'success' : 'error');

                    const fruits = board.querySelectorAll('.grid-cell.has-fruit');
                    addDebug(`æœ‰æ°´æœçš„æ ¼å­æ•°é‡: ${fruits.length}`, fruits.length > 0 ? 'success' : 'error');

                    // æ˜¾ç¤ºæ¯ä¸ªæ ¼å­çš„å†…å®¹
                    cells.forEach((cell, index) => {
                        const row = Math.floor(index / 4);
                        const col = index % 4;
                        const content = cell.textContent || '(ç©º)';
                        const hasClass = cell.classList.contains('has-fruit') ? 'æœ‰æ°´æœ' : 'ç©º';
                        addDebug(`æ ¼å­[${row},${col}]: ${content} (${hasClass})`);
                    });
                } else {
                    addDebug('æ¸¸æˆå¯¹è±¡æœªåˆ›å»º!', 'error');
                }
            }, 500);

            // æµ‹è¯•æŒ‰é’®
            document.getElementById('test-btn').addEventListener('click', () => {
                addDebug('--- æ‰‹åŠ¨æµ‹è¯•æ¸²æŸ“ ---', 'info');

                const board = document.getElementById('game-board');
                board.innerHTML = '';

                for (let i = 0; i < 16; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    if (i < 2) {
                        cell.classList.add('has-fruit');
                        cell.textContent = i === 0 ? 'ğŸ' : 'ğŸŠ';
                        cell.style.color = i === 0 ? '#ef4444' : '#f59e0b';
                    }
                    board.appendChild(cell);
                }

                addDebug('æ‰‹åŠ¨æ¸²æŸ“å®Œæˆ', 'success');

                const cells = board.querySelectorAll('.grid-cell');
                addDebug(`æ¸²æŸ“çš„æ ¼å­æ•°é‡: ${cells.length}`, cells.length === 16 ? 'success' : 'error');
            });
        });

        // é”™è¯¯æ•è·
        window.addEventListener('error', (e) => {
            addDebug(`é”™è¯¯: ${e.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            addDebug(`Promiseé”™è¯¯: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>
