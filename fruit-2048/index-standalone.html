<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æœ2048 - ç‹¬ç«‹è°ƒè¯•ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0f172a;
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin-bottom: 20px;
        }

        .debug-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 500px;
            width: 100%;
        }

        .debug-panel h3 {
            margin-top: 0;
        }

        #debug-log {
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 4px;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 12px;
            background: rgba(15, 23, 42, 0.5);
            padding: 12px;
            border-radius: 1rem;
            width: 400px;
            height: 400px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .grid-cell {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .grid-cell.has-fruit {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .grid-cell.pop {
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 8px;
        }

        button:hover {
            background: #7c3aed;
        }

        #grid-status {
            margin-top: 10px;
            font-family: monospace;
            white-space: pre;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>æ°´æœ2048 - ç‹¬ç«‹è°ƒè¯•ç‰ˆ</h1>

    <div class="debug-panel">
        <h3>è°ƒè¯•æ—¥å¿—</h3>
        <div id="debug-log"></div>
    </div>

    <div id="game-board"></div>

    <div id="grid-status"></div>

    <div class="controls">
        <button onclick="testBasicRender()">åŸºç¡€æ¸²æŸ“æµ‹è¯•</button>
        <button onclick="testGameInit()">æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•</button>
        <button onclick="clearBoard()">æ¸…ç©º</button>
    </div>

    <script>
        const debugLog = document.getElementById('debug-log');
        const gameBoard = document.getElementById('game-board');
        const gridStatus = document.getElementById('grid-status');

        function log(msg, level = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = level === 'error' ? '#ff6b6b' : level === 'warn' ? '#feca57' : '#48dbfb';
            debugLog.innerHTML += `<div style="color: ${color}">[${time}] ${msg}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${level.toUpperCase()}] ${msg}`);
        }

        function updateGridStatus(grid) {
            if (!grid) {
                gridStatus.textContent = 'æ— ç½‘æ ¼æ•°æ®';
                return;
            }

            let status = '';
            for(let r = 0; r < 4; r++) {
                for(let c = 0; c < 4; c++) {
                    const cell = grid[r][c];
                    status += cell ? `[${cell.emoji}] ` : '[   ] ';
                }
                status += '\n';
            }
            gridStatus.textContent = status;
        }

        function clearBoard() {
            gameBoard.innerHTML = '';
            log('æ£‹ç›˜å·²æ¸…ç©º');
            gridStatus.textContent = '';
        }

        // æµ‹è¯•1ï¼šåŸºç¡€æ¸²æŸ“
        function testBasicRender() {
            log('=== å¼€å§‹åŸºç¡€æ¸²æŸ“æµ‹è¯• ===');
            clearBoard();

            const fruits = ['ğŸ', 'ğŸŠ', 'ğŸ‡', 'ğŸ“', 'ğŸ‰', 'ğŸ', 'ğŸ¥­', 'ğŸ¥'];

            for(let i = 0; i < 16; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';

                if (i % 2 === 0) {
                    cell.textContent = fruits[Math.floor(Math.random() * fruits.length)];
                    cell.classList.add('has-fruit', 'pop');
                }

                gameBoard.appendChild(cell);
            }

            log(`âœ“ åˆ›å»ºäº† ${gameBoard.children.length} ä¸ªæ ¼å­`);

            // æ£€æŸ¥ç¬¬ä¸€ä¸ªæ ¼å­
            const firstCell = gameBoard.children[0];
            const computedStyle = getComputedStyle(firstCell);
            log(`ç¬¬ä¸€ä¸ªæ ¼å­:`, 'info');
            log(`  - å†…å®¹: "${firstCell.textContent}"`);
            log(`  - className: ${firstCell.className}`);
            log(`  - fontSize: ${computedStyle.fontSize}`);
            log(`  - display: ${computedStyle.display}`);
            log(`  - visibility: ${computedStyle.visibility}`);
            log(`  - opacity: ${computedStyle.opacity}`);
        }

        // æµ‹è¯•2ï¼šæ¸¸æˆç±»åˆå§‹åŒ–
        async function testGameInit() {
            log('=== å¼€å§‹æ¸¸æˆåˆå§‹åŒ–æµ‹è¯• ===');
            clearBoard();

            try {
                // åŠ¨æ€åŠ è½½æ¸¸æˆç±»
                log('æ­£åœ¨åŠ è½½ game.js...');
                const response = await fetch('game.js');
                if (!response.ok) {
                    throw new Error(`æ— æ³•åŠ è½½ game.js: ${response.status}`);
                }
                const gameCode = await response.text();
                log(`âœ“ game.js åŠ è½½æˆåŠŸ (${gameCode.length} å­—ç¬¦)`);

                // æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
                const hasFruitGame = gameCode.includes('class FruitGame');
                const hasInit = gameCode.includes('init()');
                const hasRender = gameCode.includes('render()');

                log(`ä»£ç æ£€æŸ¥:`, 'info');
                log(`  - class FruitGame: ${hasFruitGame ? 'âœ“' : 'âœ—'}`);
                log(`  - init() æ–¹æ³•: ${hasInit ? 'âœ“' : 'âœ—'}`);
                log(`  - render() æ–¹æ³•: ${hasRender ? 'âœ“' : 'âœ—'}`);

                if (!hasFruitGame) {
                    throw new Error('FruitGame ç±»æœªæ‰¾åˆ°');
                }

                // æ‰§è¡Œæ¸¸æˆä»£ç 
                log('æ­£åœ¨æ‰§è¡Œæ¸¸æˆä»£ç ...');
                const script = document.createElement('script');
                script.textContent = gameCode;
                document.head.appendChild(script);

                // ç­‰å¾…åˆå§‹åŒ–
                await new Promise(resolve => setTimeout(resolve, 500));

                // æ£€æŸ¥æ¸¸æˆå®ä¾‹
                if (window.game) {
                    log('âœ“ æ¸¸æˆå®ä¾‹å·²åˆ›å»º');
                    log(`  - Gridå¤§å°: ${window.game.gridSize}`);
                    log(`  - åˆ†æ•°: ${window.game.score}`);
                    log(`  - æ¸¸æˆæ¿å…ƒç´ : ${window.game.elements.board ? 'âœ“' : 'âœ—'}`);

                    if (window.game.grid) {
                        updateGridStatus(window.game.grid);

                        // æ£€æŸ¥æ°´æœæ•°é‡
                        let fruitCount = 0;
                        for(let r = 0; r < 4; r++) {
                            for(let c = 0; c < 4; c++) {
                                if (window.game.grid[r][c]) fruitCount++;
                            }
                        }
                        log(`  - æ°´æœæ•°é‡: ${fruitCount}`);
                    }

                    // æ‰‹åŠ¨è°ƒç”¨render
                    log('æ‰‹åŠ¨è°ƒç”¨ render()...');
                    window.game.render();
                    log(`  - æ¸²æŸ“åæ ¼å­æ•°: ${window.game.elements.board.children.length}`);

                } else {
                    log('âœ— æ¸¸æˆå®ä¾‹æœªåˆ›å»º', 'error');
                }

            } catch (error) {
                log(`âœ— é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log(`gameBoard å…ƒç´ : ${gameBoard ? 'âœ“' : 'âœ—'}`);
            log(`gameBoard å°ºå¯¸: ${gameBoard.offsetWidth}x${gameBoard.offsetHeight}`);

            // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                testBasicRender();
            }, 500);
        });

        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', (event) => {
            log(`JavaScripté”™è¯¯: ${event.message}`, 'error');
            if (event.filename) {
                log(`  æ–‡ä»¶: ${event.filename}:${event.lineno}`);
            }
        });
    </script>
</body>
</html>
