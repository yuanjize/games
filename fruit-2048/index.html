<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ°´æœ2048 - ç¾å‘³çš„æ°´æœåˆå¹¶æ¸¸æˆ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>">
    <link rel="stylesheet" href="../shared-styles.css">
</head>
<body>
    <div class="container" role="main" aria-label="æ°´æœ2048æ¸¸æˆä¸»ç•Œé¢">
        <header>
            <a href="../index.html" class="back-button" aria-label="è¿”å›æ¸¸æˆå¤§å…">
                <i class="fas fa-arrow-left" aria-hidden="true"></i> è¿”å›æ¸¸æˆå¤§å…
            </a>
            <h1><i class="fas fa-apple-alt" aria-hidden="true"></i> æ°´æœ2048</h1>
            <p class="subtitle">åˆå¹¶ç›¸åŒæ°´æœï¼Œåˆ›é€ ç¾å‘³çš„æ°´æœå¤§é¤ï¼</p>
        </header>

        <main>
            <div class="game-header">
                <div class="score-container">
                    <div class="score-box" aria-labelledby="current-score-label">
                        <div class="score-label" id="current-score-label">å½“å‰åˆ†æ•°</div>
                        <div class="score-value" id="current-score" role="status" aria-live="polite">0</div>
                    </div>
                    <div class="score-box" aria-labelledby="best-score-label">
                        <div class="score-label" id="best-score-label">æœ€é«˜åˆ†æ•°</div>
                        <div class="score-value" id="best-score" role="status" aria-live="polite">0</div>
                    </div>
                </div>

                <div class="game-controls">
                    <button class="btn" id="restart-btn" aria-label="é‡æ–°å¼€å§‹æ¸¸æˆ">
                        <i class="fas fa-redo" aria-hidden="true"></i> é‡æ–°å¼€å§‹
                    </button>
                    <button class="btn" id="instructions-btn" aria-label="æŸ¥çœ‹æ¸¸æˆè¯´æ˜">
                        <i class="fas fa-question-circle" aria-hidden="true"></i> æ¸¸æˆè¯´æ˜
                    </button>
                    <button class="btn" id="sound-toggle" aria-label="åˆ‡æ¢éŸ³æ•ˆï¼Œå½“å‰çŠ¶æ€ä¸ºå¼€å¯">
                        <i class="fas fa-volume-up" aria-hidden="true"></i> <span>éŸ³æ•ˆ: å¼€</span>
                    </button>
                    <div class="difficulty-selector">
                        <label for="difficulty">éš¾åº¦:</label>
                        <select id="difficulty" aria-label="é€‰æ‹©æ¸¸æˆéš¾åº¦">
                            <option value="easy">ç®€å•</option>
                            <option value="normal" selected>æ™®é€š</option>
                            <option value="hard">å›°éš¾</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="game-info">
                <div class="goal-container">
                    <h3><i class="fas fa-bullseye" aria-hidden="true"></i> æ¸¸æˆç›®æ ‡</h3>
                    <p>åˆå¹¶æ°´æœç›´åˆ°è·å¾— <span class="goal-fruit">ğŸ‘ æ¡ƒå­</span>ï¼</p>
                    <div class="fruit-progress">
                        <div class="fruit-chain" aria-label="æ°´æœåˆå¹¶é¡ºåºï¼šè‹¹æœã€æ©™å­ã€è‘¡è„ã€è‰è“ã€è¥¿ç“œã€è èã€èŠ’æœã€çŒ•çŒ´æ¡ƒã€æ¨±æ¡ƒã€æ¡ƒå­">
                            <div class="fruit-item" data-fruit="ğŸ" aria-label="è‹¹æœ">ğŸ</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸŠ" aria-label="æ©™å­">ğŸŠ</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ‡" aria-label="è‘¡è„">ğŸ‡</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ“" aria-label="è‰è“">ğŸ“</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ‰" aria-label="è¥¿ç“œ">ğŸ‰</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ" aria-label="è è">ğŸ</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ¥­" aria-label="èŠ’æœ">ğŸ¥­</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ¥" aria-label="çŒ•çŒ´æ¡ƒ">ğŸ¥</div>
                            <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            <div class="fruit-item" data-fruit="ğŸ’" aria-label="æ¨±æ¡ƒ">ğŸ’</div>
                        </div>
                    </div>
                </div>

                <div class="controls-info">
                    <h3><i class="fas fa-gamepad" aria-hidden="true"></i> æ“ä½œè¯´æ˜</h3>
                    <div class="controls-grid" aria-label="é”®ç›˜æ§åˆ¶è¯´æ˜">
                        <div class="control-item">
                            <div class="keyboard-key" aria-hidden="true">â†‘</div>
                            <span>å‘ä¸Šç§»åŠ¨</span>
                        </div>
                        <div class="control-item">
                            <div class="keyboard-key" aria-hidden="true">â†“</div>
                            <span>å‘ä¸‹ç§»åŠ¨</span>
                        </div>
                        <div class="control-item">
                            <div class="keyboard-key" aria-hidden="true">â†</div>
                            <span>å‘å·¦ç§»åŠ¨</span>
                        </div>
                        <div class="control-item">
                            <div class="keyboard-key" aria-hidden="true">â†’</div>
                            <span>å‘å³ç§»åŠ¨</span>
                        </div>
                        <div class="control-item">
                            <div class="keyboard-key" aria-hidden="true">R</div>
                            <span>é‡æ–°å¼€å§‹</span>
                        </div>
                    </div>
                    <div class="next-fruit-preview" aria-label="ä¸‹ä¸€ä¸ªå‡ºç°çš„æ°´æœ">
                        <span>ä¸‹ä¸€ä¸ªæ°´æœ:</span>
                        <div class="next-fruit" id="next-fruit" role="status" aria-live="polite">ğŸ</div>
                    </div>
                    <p class="mobile-note">åœ¨æ‰‹æœºä¸Šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ»‘åŠ¨æ“ä½œï¼</p>
                </div>
            </div>

            <div class="game-board-container">
                <div class="game-board" id="game-board" role="application" aria-label="æ°´æœ2048æ¸¸æˆæ£‹ç›˜" tabindex="0">
                    <!-- 4x4ç½‘æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="game-status" id="game-status" role="status" aria-live="polite" aria-label="æ¸¸æˆçŠ¶æ€">
                    <div class="status-message">æ¸¸æˆè¿›è¡Œä¸­</div>
                </div>
            </div>

            <div class="mobile-controls" id="mobile-controls">
                <div class="mobile-controls-title">
                    <i class="fas fa-gamepad" aria-hidden="true"></i> æ‰‹æœºæ§åˆ¶
                </div>
                <button class="mobile-btn" data-direction="up" aria-label="å‘ä¸Šç§»åŠ¨">
                    <i class="fas fa-chevron-up" aria-hidden="true"></i>
                </button>
                <div class="mobile-row">
                    <button class="mobile-btn" data-direction="left" aria-label="å‘å·¦ç§»åŠ¨">
                        <i class="fas fa-chevron-left" aria-hidden="true"></i>
                    </button>
                    <button class="mobile-btn" data-direction="right" aria-label="å‘å³ç§»åŠ¨">
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </button>
                </div>
                <button class="mobile-btn" data-direction="down" aria-label="å‘ä¸‹ç§»åŠ¨">
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </button>
                <p class="mobile-hint">æç¤ºï¼šä¹Ÿå¯åœ¨æ¸¸æˆåŒºåŸŸæ»‘åŠ¨æ“ä½œ</p>
            </div>
        </main>

        <footer>
            <p>æ°´æœ2048 Â© 2023 | ä½¿ç”¨åŸç”ŸJavaScriptã€HTMLå’ŒCSSå¼€å‘ |
                <a href="#" id="credits-link" aria-label="æŸ¥çœ‹æ¸¸æˆè¯´æ˜">æ¸¸æˆè¯´æ˜</a>
            </p>
        </footer>
    </div>

    <!-- æ¸¸æˆè¯´æ˜æ¨¡æ€æ¡† -->
    <div class="modal" id="instructions-modal" role="dialog" aria-labelledby="instructions-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="instructions-title"><i class="fas fa-info-circle" aria-hidden="true"></i> æ¸¸æˆè¯´æ˜</h2>
                <button class="modal-close" id="instructions-close" aria-label="å…³é—­æ¸¸æˆè¯´æ˜">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="instructions-section">
                    <h3 id="rules-title">æ¸¸æˆè§„åˆ™</h3>
                    <ul aria-labelledby="rules-title">
                        <li><strong>ç›®æ ‡ï¼š</strong>é€šè¿‡ç§»åŠ¨å’Œåˆå¹¶æ°´æœï¼Œæœ€ç»ˆè·å¾—æ¡ƒå­ï¼ˆğŸ‘ï¼‰</li>
                        <li><strong>ç§»åŠ¨ï¼š</strong>æŒ‰æ–¹å‘é”®æ—¶ï¼Œ<span class="highlight">æ£‹ç›˜ä¸Šæ‰€æœ‰æ°´æœéƒ½ä¼šå‘è¯¥æ–¹å‘ç§»åŠ¨</span>ï¼Œç›´åˆ°ç¢°åˆ°è¾¹ç¼˜æˆ–å…¶ä»–æ°´æœ</li>
                        <li><strong>åˆå¹¶ï¼š</strong>å½“ä¸¤ä¸ªç›¸åŒçš„æ°´æœç¢°æ’æ—¶ï¼Œä¼šåˆå¹¶æˆä¸‹ä¸€ä¸ªç­‰çº§çš„æ°´æœï¼ˆä¾‹å¦‚ï¼šğŸ+ğŸ=ğŸŠï¼‰</li>
                        <li><strong>æ–°æ°´æœï¼š</strong>æ¯æ¬¡ç§»åŠ¨åï¼Œä¼šåœ¨ç©ºä½éšæœºå‡ºç°ä¸€ä¸ªæ–°çš„æ°´æœ</li>
                        <li><strong>å¾—åˆ†ï¼š</strong>æ¯æ¬¡åˆå¹¶éƒ½ä¼šè·å¾—åˆ†æ•°ï¼Œåˆå¹¶çš„æ°´æœç­‰çº§è¶Šé«˜ï¼Œåˆ†æ•°è¶Šå¤š</li>
                        <li><strong>æ¸¸æˆç»“æŸï¼š</strong>å½“æ£‹ç›˜å¡«æ»¡ä¸”æ— æ³•è¿›è¡Œä»»ä½•ç§»åŠ¨æ—¶ï¼Œæ¸¸æˆç»“æŸ</li>
                    </ul>
                </div>

                <div class="instructions-section">
                    <h3 id="fruit-order-title">æ°´æœåˆå¹¶é¡ºåº</h3>
                    <div class="fruit-merging-chain" role="region" aria-labelledby="fruit-order-title">
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="è‹¹æœ">ğŸ</div>
                            <div class="stage-label">è‹¹æœ</div>
                        </div>
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        <i class="fas fa-equals" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="æ©™å­">ğŸŠ</div>
                            <div class="stage-label">æ©™å­</div>
                        </div>
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        <i class="fas fa-equals" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="è‘¡è„">ğŸ‡</div>
                            <div class="stage-label">è‘¡è„</div>
                        </div>
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        <i class="fas fa-equals" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="è‰è“">ğŸ“</div>
                            <div class="stage-label">è‰è“</div>
                        </div>
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        <i class="fas fa-equals" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="è¥¿ç“œ">ğŸ‰</div>
                            <div class="stage-label">è¥¿ç“œ</div>
                        </div>
                    </div>
                </div>

                <div class="instructions-section">
                    <h3 id="advanced-title">é«˜çº§æ°´æœ</h3>
                    <div class="fruit-merging-chain" role="region" aria-labelledby="advanced-title">
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="è è">ğŸ</div>
                            <div class="stage-label">è è</div>
                        </div>
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="èŠ’æœ">ğŸ¥­</div>
                            <div class="stage-label">èŠ’æœ</div>
                        </div>
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="çŒ•çŒ´æ¡ƒ">ğŸ¥</div>
                            <div class="stage-label">çŒ•çŒ´æ¡ƒ</div>
                        </div>
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="æ¨±æ¡ƒ">ğŸ’</div>
                            <div class="stage-label">æ¨±æ¡ƒ</div>
                        </div>
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                        <div class="fruit-stage">
                            <div class="fruit-emoji" aria-label="æ¡ƒå­ï¼Œæœ€ç»ˆç›®æ ‡">ğŸ‘</div>
                            <div class="stage-label">æ¡ƒå­ (ç›®æ ‡)</div>
                        </div>
                    </div>
                </div>

                <div class="instructions-section">
                    <h3 id="tips-title">æç¤ºä¸æŠ€å·§</h3>
                    <ul aria-labelledby="tips-title">
                        <li>å°½é‡ä¿æŒæœ€å¤§æ°´æœåœ¨è§’è½ä½ç½®</li>
                        <li>è§„åˆ’å¥½ç§»åŠ¨é¡ºåºï¼Œé¿å…æ£‹ç›˜è¿‡æ—©å¡«æ»¡</li>
                        <li>ä¼˜å…ˆåˆå¹¶ä½ç­‰çº§æ°´æœä»¥è…¾å‡ºç©ºé—´</li>
                        <li>æ³¨æ„è§‚å¯Ÿä¸‹ä¸€ä¸ªå³å°†å‡ºç°çš„æ°´æœ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="modal" id="game-over-modal" role="dialog" aria-labelledby="game-over-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="game-over-title"><i class="fas fa-trophy" aria-hidden="true"></i> æ¸¸æˆç»“æŸ</h2>
            </div>
            <div class="modal-body">
                <div class="game-result">
                    <div class="result-score">
                        <h3 id="final-score-title">æœ€ç»ˆåˆ†æ•°</h3>
                        <div class="final-score" id="final-score" aria-labelledby="final-score-title" role="status" aria-live="polite">0</div>
                    </div>

                    <div class="result-best">
                        <h3 id="best-display-title">æœ€é«˜åˆ†æ•°</h3>
                        <div class="best-score-display" id="best-score-display" aria-labelledby="best-display-title">0</div>
                    </div>

                    <div class="result-message" id="result-message" role="status" aria-live="assertive">
                        å·®ä¸€ç‚¹å°±æˆåŠŸäº†ï¼å†è¯•ä¸€æ¬¡å§ï¼
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-primary" id="play-again-btn" aria-label="é‡æ–°å¼€å§‹æ¸¸æˆ">
                        <i class="fas fa-play" aria-hidden="true"></i> å†æ¥ä¸€å±€
                    </button>
                    <button class="btn" id="share-btn" aria-label="åˆ†äº«æ¸¸æˆæˆç»©">
                        <i class="fas fa-share-alt" aria-hidden="true"></i> åˆ†äº«æˆç»©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" id="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
        <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <!-- ç²’å­æ•ˆæœå®¹å™¨ -->
    <div class="particles-container" id="particles-container"></div>

    <script src="game.js"></script>
    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('i');

        // ä» localStorage è¯»å–ä¸»é¢˜
        const savedTheme = localStorage.getItem('fruit2048-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('fruit2048-theme', newTheme);
            updateThemeIcon(newTheme);
        });

        function updateThemeIcon(theme) {
            themeIcon.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }

        // ç²’å­æ•ˆæœå‡½æ•°
        function createParticles(x, y, count = 8, color = '#fbbf24') {
            const container = document.getElementById('particles-container');
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const size = Math.random() * 8 + 4;
                const angle = (Math.PI * 2 * i) / count;
                const distance = Math.random() * 60 + 40;
                particle.style.cssText = `
                    left: ${x}px;
                    top: ${y}px;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    --tx: ${Math.cos(angle) * distance}px;
                    --ty: ${Math.sin(angle) * distance}px;
                `;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 800);
            }
        }

        // æ•°å­—æ»šåŠ¨åŠ¨ç”»
        function animateNumber(element, targetValue, duration = 500) {
            const startValue = parseInt(element.textContent) || 0;
            const difference = targetValue - startValue;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.round(startValue + difference * easeProgress);
                element.textContent = currentValue;

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä¾›æ¸¸æˆä½¿ç”¨
        window.gameEffects = { createParticles, animateNumber };
    </script>
</body>
</html>
