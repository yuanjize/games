<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æœ2048 - åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        h1 { color: #ff6b6b; }
        h2 { color: #4facfe; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #4facfe;
            background: #f8f9ff;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button {
            padding: 10px 20px;
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #3d8bce; }
        .game-container {
            width: 400px;
            height: 400px;
            border: 2px solid #ccc;
            margin: 20px 0;
            position: relative;
        }
    </style>
</head>
<body>
    <h1>æ°´æœ2048 - åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>åŸºæœ¬åŠŸèƒ½æµ‹è¯•</h2>

        <div id="test-1" class="test-result">
            <h3>1. æ–‡ä»¶åŠ è½½æµ‹è¯•</h3>
            <p>æ­£åœ¨æ£€æŸ¥æ¸¸æˆæ–‡ä»¶...</p>
        </div>

        <div id="test-2" class="test-result">
            <h3>2. æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•</h3>
            <p>æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆ...</p>
        </div>

        <div id="test-3" class="test-result">
            <h3>3. æ¸¸æˆç½‘æ ¼æµ‹è¯•</h3>
            <p>æ­£åœ¨æ£€æŸ¥4x4ç½‘æ ¼...</p>
        </div>

        <div id="test-4" class="test-result">
            <h3>4. æ°´æœç”Ÿæˆæµ‹è¯•</h3>
            <p>æ­£åœ¨æ£€æŸ¥åˆå§‹æ°´æœç”Ÿæˆ...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>æ¸¸æˆåŠŸèƒ½æµ‹è¯•</h2>

        <div id="test-5" class="test-result">
            <h3>5. ç§»åŠ¨åŠŸèƒ½æµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•ç§»åŠ¨åŠŸèƒ½...</p>
            <button onclick="testMove('up')">å‘ä¸Šç§»åŠ¨</button>
            <button onclick="testMove('down')">å‘ä¸‹ç§»åŠ¨</button>
            <button onclick="testMove('left')">å‘å·¦ç§»åŠ¨</button>
            <button onclick="testMove('right')">å‘å³ç§»åŠ¨</button>
        </div>

        <div id="test-6" class="test-result">
            <h3>6. åˆå¹¶åŠŸèƒ½æµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•æ°´æœåˆå¹¶...</p>
        </div>

        <div id="test-7" class="test-result">
            <h3>7. åˆ†æ•°ç³»ç»Ÿæµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•åˆ†æ•°è®¡ç®—...</p>
        </div>

        <div id="test-8" class="test-result">
            <h3>8. æ¸¸æˆç»“æŸæ£€æµ‹æµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•æ¸¸æˆç»“æŸæ£€æµ‹...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>ç§»åŠ¨è®¾å¤‡å…¼å®¹æ€§æµ‹è¯•</h2>

        <div id="test-9" class="test-result">
            <h3>9. è§¦æ‘¸äº‹ä»¶æµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•è§¦æ‘¸äº‹ä»¶æ”¯æŒ...</p>
        </div>

        <div id="test-10" class="test-result">
            <h3>10. å“åº”å¼è®¾è®¡æµ‹è¯•</h3>
            <p>æ­£åœ¨æµ‹è¯•å“åº”å¼å¸ƒå±€...</p>
        </div>
    </div>

    <div class="game-container" id="game-preview">
        <!-- æ¸¸æˆé¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>

    <div style="margin-top: 30px;">
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="window.open('index.html', '_blank')">æ‰“å¼€å®Œæ•´æ¸¸æˆ</button>
    </div>

    <script>
        // æµ‹è¯•é…ç½®
        const testResults = {
            passed: 0,
            total: 10
        };

        // æµ‹è¯•1ï¼šæ–‡ä»¶åŠ è½½
        function testFileLoading() {
            const testElement = document.getElementById('test-1');
            try {
                // å°è¯•åŠ è½½æ¸¸æˆæ–‡ä»¶
                const files = ['index.html', 'style.css', 'game.js'];
                let allFilesExist = true;

                files.forEach(file => {
                    fetch(file)
                        .catch(() => {
                            allFilesExist = false;
                        });
                });

                if (allFilesExist) {
                    testElement.innerHTML += `<p class="success">âœ“ æ‰€æœ‰æ¸¸æˆæ–‡ä»¶å·²æ­£ç¡®åŠ è½½</p>`;
                    testResults.passed++;
                } else {
                    testElement.innerHTML += `<p class="warning">âš  éƒ¨åˆ†æ–‡ä»¶å¯èƒ½æœªæ­£ç¡®åŠ è½½</p>`;
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— æ–‡ä»¶åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•2ï¼šæ¸¸æˆåˆå§‹åŒ–
        function testGameInitialization() {
            const testElement = document.getElementById('test-2');
            try {
                // æ£€æŸ¥æ¸¸æˆé…ç½®
                if (typeof window.fruit2048 !== 'undefined' &&
                    typeof window.fruit2048.CONFIG !== 'undefined') {
                    testElement.innerHTML += `<p class="success">âœ“ æ¸¸æˆé…ç½®å·²åŠ è½½</p>`;

                    // æ£€æŸ¥ç½‘æ ¼å¤§å°
                    if (window.fruit2048.CONFIG.GRID_SIZE === 4) {
                        testElement.innerHTML += `<p class="success">âœ“ ç½‘æ ¼å¤§å°æ­£ç¡®: 4x4</p>`;
                    }

                    testResults.passed++;
                } else {
                    testElement.innerHTML += `<p class="error">âœ— æ¸¸æˆé…ç½®æœªæ‰¾åˆ°</p>`;
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•3ï¼šæ¸¸æˆç½‘æ ¼
        function testGameGrid() {
            const testElement = document.getElementById('test-3');
            try {
                if (typeof window.fruit2048 !== 'undefined' &&
                    typeof window.fruit2048.gameState !== 'undefined') {

                    // æ£€æŸ¥ç½‘æ ¼æ•°æ®ç»“æ„
                    const grid = window.fruit2048.gameState.grid;
                    if (Array.isArray(grid) && grid.length === 4) {
                        let validGrid = true;
                        for (let i = 0; i < grid.length; i++) {
                            if (!Array.isArray(grid[i]) || grid[i].length !== 4) {
                                validGrid = false;
                                break;
                            }
                        }

                        if (validGrid) {
                            testElement.innerHTML += `<p class="success">âœ“ æ¸¸æˆç½‘æ ¼ç»“æ„æ­£ç¡®</p>`;
                            testResults.passed++;
                        } else {
                            testElement.innerHTML += `<p class="error">âœ— æ¸¸æˆç½‘æ ¼ç»“æ„ä¸æ­£ç¡®</p>`;
                        }
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— ç½‘æ ¼æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•4ï¼šæ°´æœç”Ÿæˆ
        function testFruitGeneration() {
            const testElement = document.getElementById('test-4');
            try {
                if (typeof window.fruit2048 !== 'undefined') {
                    // æµ‹è¯•æ·»åŠ æ°´æœåŠŸèƒ½
                    const result = window.fruit2048.addRandomFruit();

                    if (typeof result === 'boolean') {
                        testElement.innerHTML += `<p class="success">âœ“ æ°´æœç”Ÿæˆå‡½æ•°å·¥ä½œæ­£å¸¸</p>`;

                        // æ£€æŸ¥æ°´æœé…ç½®
                        const fruits = window.fruit2048.CONFIG.FRUITS;
                        if (Array.isArray(fruits) && fruits.length >= 6) {
                            testElement.innerHTML += `<p class="success">âœ“ æ°´æœé…ç½®å·²åŠ è½½ (${fruits.length} ç§æ°´æœ)</p>`;
                        }

                        testResults.passed++;
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— æ°´æœç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•5ï¼šç§»åŠ¨åŠŸèƒ½
        function testMove(direction) {
            const testElement = document.getElementById('test-5');
            try {
                if (typeof window.fruit2048 !== 'undefined') {
                    const result = window.fruit2048.move(direction);

                    testElement.innerHTML += `<p class="${result ? 'success' : 'warning'}">${result ? 'âœ“' : 'âš '} ${direction} æ–¹å‘ç§»åŠ¨${result ? 'æˆåŠŸ' : 'æ— æ•ˆ'}</p>`;

                    if (result) {
                        testResults.passed++;
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— ç§»åŠ¨æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•6ï¼šåˆå¹¶åŠŸèƒ½
        function testMergeFunction() {
            const testElement = document.getElementById('test-6');
            try {
                if (typeof window.fruit2048 !== 'undefined') {
                    // æµ‹è¯•åˆå¹¶é€»è¾‘
                    const processLine = window.fruit2048.processLine;

                    if (typeof processLine === 'function') {
                        // æµ‹è¯•ä¸€è¡Œæ°´æœçš„åˆå¹¶
                        const testLine = [
                            { level: 1, emoji: "ğŸ", name: "è‹¹æœ" },
                            { level: 1, emoji: "ğŸ", name: "è‹¹æœ" },
                            null,
                            { level: 2, emoji: "ğŸŒ", name: "é¦™è•‰" }
                        ];

                        const result = processLine(testLine, -1);

                        if (result && result.cells && result.score !== undefined) {
                            testElement.innerHTML += `<p class="success">âœ“ åˆå¹¶é€»è¾‘å·¥ä½œæ­£å¸¸</p>`;
                            testResults.passed++;
                        }
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— åˆå¹¶æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•7ï¼šåˆ†æ•°ç³»ç»Ÿ
        function testScoreSystem() {
            const testElement = document.getElementById('test-7');
            try {
                if (typeof window.fruit2048 !== 'undefined') {
                    const gameState = window.fruit2048.gameState;

                    if (typeof gameState.score === 'number' &&
                        typeof gameState.bestScore === 'number') {
                        testElement.innerHTML += `<p class="success">âœ“ åˆ†æ•°ç³»ç»Ÿå·²åˆå§‹åŒ–</p>`;
                        testElement.innerHTML += `<p>å½“å‰åˆ†æ•°: ${gameState.score}, æœ€é«˜åˆ†æ•°: ${gameState.bestScore}</p>`;
                        testResults.passed++;
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— åˆ†æ•°ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•8ï¼šæ¸¸æˆç»“æŸæ£€æµ‹
        function testGameOverDetection() {
            const testElement = document.getElementById('test-8');
            try {
                if (typeof window.fruit2048 !== 'undefined') {
                    const canMove = window.fruit2048.canMove;

                    if (typeof canMove === 'function') {
                        testElement.innerHTML += `<p class="success">âœ“ æ¸¸æˆç»“æŸæ£€æµ‹åŠŸèƒ½å¯ç”¨</p>`;
                        testResults.passed++;
                    }
                }
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— æ¸¸æˆç»“æŸæ£€æµ‹æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•9ï¼šè§¦æ‘¸äº‹ä»¶
        function testTouchEvents() {
            const testElement = document.getElementById('test-9');
            try {
                // æ£€æŸ¥è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                const touchSupport = 'ontouchstart' in window ||
                                    navigator.maxTouchPoints > 0 ||
                                    navigator.msMaxTouchPoints > 0;

                if (touchSupport) {
                    testElement.innerHTML += `<p class="success">âœ“ è§¦æ‘¸äº‹ä»¶æ”¯æŒ: å·²å¯ç”¨</p>`;
                } else {
                    testElement.innerHTML += `<p class="warning">âš  è§¦æ‘¸äº‹ä»¶æ”¯æŒ: æœªæ£€æµ‹åˆ°è§¦æ‘¸è®¾å¤‡</p>`;
                }

                testResults.passed++;
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— è§¦æ‘¸äº‹ä»¶æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æµ‹è¯•10ï¼šå“åº”å¼è®¾è®¡
        function testResponsiveDesign() {
            const testElement = document.getElementById('test-10');
            try {
                // æ£€æŸ¥è§†å£è®¾ç½®
                const viewportMeta = document.querySelector('meta[name="viewport"]');

                if (viewportMeta && viewportMeta.content.includes('width=device-width')) {
                    testElement.innerHTML += `<p class="success">âœ“ å“åº”å¼è§†å£è®¾ç½®æ­£ç¡®</p>`;
                }

                // æ£€æŸ¥åª’ä½“æŸ¥è¯¢æ”¯æŒ
                const mediaQuerySupport = typeof window.matchMedia === 'function';

                if (mediaQuerySupport) {
                    testElement.innerHTML += `<p class="success">âœ“ åª’ä½“æŸ¥è¯¢æ”¯æŒ: å·²å¯ç”¨</p>`;
                }

                testResults.passed++;
            } catch (error) {
                testElement.innerHTML += `<p class="error">âœ— å“åº”å¼è®¾è®¡æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            // é‡ç½®æµ‹è¯•ç»“æœ
            testResults.passed = 0;

            // è¿è¡Œæ‰€æœ‰æµ‹è¯•
            testFileLoading();
            testGameInitialization();
            testGameGrid();
            testFruitGeneration();
            testMergeFunction();
            testScoreSystem();
            testGameOverDetection();
            testTouchEvents();
            testResponsiveDesign();

            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            setTimeout(() => {
                const finalResult = document.createElement('div');
                finalResult.className = `test-result ${testResults.passed === testResults.total ? 'success' : 'warning'}`;
                finalResult.innerHTML = `
                    <h3>æµ‹è¯•å®Œæˆ</h3>
                    <p>é€šè¿‡ ${testResults.passed}/${testResults.total} é¡¹æµ‹è¯•</p>
                    <p>æˆåŠŸç‡: ${(testResults.passed / testResults.total * 100).toFixed(1)}%</p>
                    ${testResults.passed === testResults.total ?
                        '<p class="success">âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ¸¸æˆåŠŸèƒ½æ­£å¸¸ã€‚</p>' :
                        '<p class="warning">âš  éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥æ¸¸æˆåŠŸèƒ½ã€‚</p>'}
                `;

                document.body.appendChild(finalResult);
            }, 1000);
        }

        // é¡µé¢åŠ è½½åè¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            testFileLoading();
            testGameInitialization();
            setTimeout(() => {
                testGameGrid();
                testFruitGeneration();
                testMergeFunction();
                testScoreSystem();
                testGameOverDetection();
                testTouchEvents();
                testResponsiveDesign();
            }, 500);
        });
    </script>
</body>
</html>