<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>记忆翻牌匹配游戏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <script>
        // 主题初始化脚本 - 防止闪烁
        (function() {
            const savedTheme = localStorage.getItem('memoryCardsTheme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
</head>
<body>
    <!-- 加载屏幕 -->
    <div class="loading-screen" id="loadingScreen" aria-live="polite" aria-atomic="true">
        <div class="loading-content">
            <div class="loading-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h2 class="loading-title">记忆翻牌大挑战</h2>
            <p class="loading-subtitle">正在准备游戏...</p>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">0%</span>
            </div>
        </div>
    </div>

    <!-- 浮动控制按钮 -->
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题模式" title="切换亮色/暗色模式">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <button class="contrast-toggle" id="contrastToggle" aria-label="切换高对比度模式" title="切换高对比度模式">
        <i class="fas fa-adjust"></i>
    </button>

    <button class="sound-toggle" id="soundToggle" aria-label="切换音效" title="音效开关">
        <i class="fas fa-volume-up" id="soundIcon"></i>
    </button>

    <button class="sound-settings-btn" id="soundSettingsBtn" aria-label="音效设置" title="音效设置">
        <i class="fas fa-sliders-h"></i>
    </button>

    <button class="help-button" id="helpButton" aria-label="游戏帮助" title="游戏说明">
        <i class="fas fa-question"></i>
    </button>

    <!-- 帮助弹窗 -->
    <div class="help-modal" id="helpModal" role="dialog" aria-labelledby="help-modal-title">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2 id="help-modal-title"><i class="fas fa-question-circle"></i> 游戏说明</h2>
                <button class="close-modal" id="closeHelp" aria-label="关闭帮助">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="help-modal-body">
                <section>
                    <h3><i class="fas fa-gamepad"></i> 游戏规则</h3>
                    <ul>
                        <li>点击卡片翻开查看图案</li>
                        <li>连续翻开两张相同的卡片即为匹配成功</li>
                        <li>找出所有匹配的卡片对即可获胜</li>
                        <li>尝试用最少的步数和时间完成游戏</li>
                    </ul>
                </section>
                <section>
                    <h3><i class="fas fa-keyboard"></i> 键盘快捷键</h3>
                    <ul>
                        <li><kbd>Tab</kbd> / <kbd>Shift+Tab</kbd> - 切换焦点</li>
                        <li><kbd>Enter</kbd> / <kbd>Space</kbd> - 翻开卡片 / 确认</li>
                        <li><kbd>↑</kbd> <kbd>↓</kbd> <kbd>←</kbd> <kbd>→</kbd> - 难度选择</li>
                        <li><kbd>Ctrl+R</kbd> - 重新开始</li>
                        <li><kbd>M</kbd> - 静音/取消静音</li>
                        <li><kbd>Escape</kbd> - 关闭弹窗</li>
                    </ul>
                </section>
                <section>
                    <h3><i class="fas fa-hand-pointer"></i> 触摸手势</h3>
                    <ul>
                        <li>单击 - 翻开卡片</li>
                        <li>双指点击 - 暂停/继续游戏</li>
                        <li>长按 - 查看卡片提示</li>
                    </ul>
                </section>
                <section>
                    <h3><i class="fas fa-trophy"></i> 难度级别</h3>
                    <ul>
                        <li><strong>简单 (4x4)</strong> - 8对卡片，适合新手</li>
                        <li><strong>中等 (6x6)</strong> - 18对卡片，适合进阶</li>
                        <li><strong>困难 (8x8)</strong> - 32对卡片，适合挑战</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <!-- 音效设置弹窗 -->
    <div class="sound-settings-modal" id="soundSettingsModal" role="dialog" aria-labelledby="sound-settings-title">
        <div class="sound-settings-content">
            <div class="sound-settings-header">
                <h2 id="sound-settings-title"><i class="fas fa-volume-up"></i> 音效设置</h2>
                <button class="close-modal" id="closeSoundSettings" aria-label="关闭音效设置">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sound-settings-body">
                <!-- 音效开关 -->
                <div class="sound-setting-row">
                    <div class="sound-setting-label">
                        <i class="fas fa-volume-up"></i>
                        <span>启用音效</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundEnabledToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- 主音量控制 -->
                <div class="sound-setting-row">
                    <div class="sound-setting-label">
                        <i class="fas fa-sliders-h"></i>
                        <span>主音量</span>
                    </div>
                    <div class="volume-control">
                        <input type="range" id="masterVolume" class="volume-slider" min="0" max="100" value="50">
                        <span class="volume-value" id="masterVolumeValue">50%</span>
                    </div>
                </div>

                <!-- 音效预览 -->
                <div class="sound-preview-section">
                    <h3><i class="fas fa-headphones"></i> 音效预览</h3>
                    <div class="sound-preview-buttons">
                        <button class="preview-btn" data-sound="flip" aria-label="预览翻牌音效">
                            <i class="fas fa-sync-alt"></i>
                            <span>翻牌</span>
                        </button>
                        <button class="preview-btn" data-sound="match" aria-label="预览匹配音效">
                            <i class="fas fa-check"></i>
                            <span>匹配</span>
                        </button>
                        <button class="preview-btn" data-sound="noMatch" aria-label="预览失败音效">
                            <i class="fas fa-times"></i>
                            <span>失败</span>
                        </button>
                        <button class="preview-btn" data-sound="win" aria-label="预览胜利音效">
                            <i class="fas fa-trophy"></i>
                            <span>胜利</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" role="main">
        <header class="game-header" role="banner">
            <a href="../index.html" class="back-button" aria-label="返回游戏大厅">
                <i class="fas fa-arrow-left" aria-hidden="true"></i> 返回游戏大厅
            </a>
            <h1><i class="fas fa-brain" aria-hidden="true"></i> <span class="sr-only">图标：</span>记忆翻牌大挑战</h1>
            <p class="subtitle">测试你的记忆力！翻开卡片找出所有匹配的图案</p>
        </header>

        <main class="game-container" role="main">
            <div class="game-controls" aria-label="游戏控制面板">
                <div class="difficulty-selector">
                    <span id="difficulty-label">难度：</span>
                    <div class="difficulty-buttons" role="radiogroup" aria-labelledby="difficulty-label">
                        <button class="difficulty-btn active"
                                data-difficulty="easy"
                                role="radio"
                                aria-checked="true"
                                tabindex="0"
                                id="difficulty-easy"
                                aria-labelledby="difficulty-label difficulty-easy-label">
                            <span id="difficulty-easy-label">简单 (4x4)</span>
                        </button>
                        <button class="difficulty-btn"
                                data-difficulty="medium"
                                role="radio"
                                aria-checked="false"
                                tabindex="-1"
                                id="difficulty-medium"
                                aria-labelledby="difficulty-label difficulty-medium-label">
                            <span id="difficulty-medium-label">中等 (6x6)</span>
                        </button>
                        <button class="difficulty-btn"
                                data-difficulty="hard"
                                role="radio"
                                aria-checked="false"
                                tabindex="-1"
                                id="difficulty-hard"
                                aria-labelledby="difficulty-label difficulty-hard-label">
                            <span id="difficulty-hard-label">困难 (8x8)</span>
                        </button>
                    </div>
                </div>

                <div class="game-stats" aria-label="游戏统计数据">
                    <div class="stat-box" aria-labelledby="time-label">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label" id="time-label">时间</div>
                            <div class="stat-value" id="timer" aria-live="polite" aria-atomic="true">00:00</div>
                        </div>
                    </div>

                    <div class="stat-box" aria-labelledby="moves-label">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label" id="moves-label">翻牌次数</div>
                            <div class="stat-value" id="moves" aria-live="polite" aria-atomic="true">0</div>
                        </div>
                    </div>

                    <div class="stat-box" aria-labelledby="matches-label">
                        <div class="stat-icon" aria-hidden="true">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label" id="matches-label">匹配数</div>
                            <div class="stat-value" id="matches" aria-live="polite" aria-atomic="true">0 / 8</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons" aria-label="操作按钮">
                    <button class="btn btn-pause" id="pauseBtn" aria-label="暂停游戏">
                        <i class="fas fa-pause" aria-hidden="true"></i> 暂停
                    </button>
                    <button class="btn btn-restart" id="restartBtn" aria-label="重新开始游戏">
                        <i class="fas fa-redo" aria-hidden="true"></i> 重新开始
                    </button>
                    <button class="btn btn-theme" id="themeBtn" aria-label="更换游戏主题，当前主题：动物">
                        <i class="fas fa-palette" aria-hidden="true"></i> 更换主题
                    </button>
                </div>
            </div>

            <div class="game-board-container">
                <div class="game-board" id="gameBoard" role="grid" aria-label="记忆卡片游戏板">
                    <!-- 卡片会通过JavaScript动态生成 -->
                </div>
                <!-- 暂停遮罩层 -->
                <div class="pause-overlay" id="pauseOverlay" aria-hidden="true">
                    <div class="pause-content">
                        <i class="fas fa-pause-circle"></i>
                        <h2>游戏已暂停</h2>
                        <p>点击"继续"按钮恢复游戏</p>
                        <button class="btn btn-resume" id="resumeBtn">
                            <i class="fas fa-play"></i> 继续游戏
                        </button>
                    </div>
                </div>
            </div>

            <div class="best-scores" aria-labelledby="best-scores-heading">
                <h3 id="best-scores-heading"><i class="fas fa-trophy" aria-hidden="true"></i> 最佳成绩</h3>
                <div class="score-cards">
                    <div class="score-card" aria-labelledby="easy-score-title">
                        <div class="score-title" id="easy-score-title">简单模式</div>
                        <div class="score-details">
                            <div class="score-item">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                                <span>时间: <span id="bestTimeEasy">--:--</span></span>
                            </div>
                            <div class="score-item">
                                <i class="fas fa-mouse-pointer" aria-hidden="true"></i>
                                <span>步数: <span id="bestMovesEasy">--</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="score-card" aria-labelledby="medium-score-title">
                        <div class="score-title" id="medium-score-title">中等模式</div>
                        <div class="score-details">
                            <div class="score-item">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                                <span>时间: <span id="bestTimeMedium">--:--</span></span>
                            </div>
                            <div class="score-item">
                                <i class="fas fa-mouse-pointer" aria-hidden="true"></i>
                                <span>步数: <span id="bestMovesMedium">--</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="score-card" aria-labelledby="hard-score-title">
                        <div class="score-title" id="hard-score-title">困难模式</div>
                        <div class="score-details">
                            <div class="score-item">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                                <span>时间: <span id="bestTimeHard">--:--</span></span>
                            </div>
                            <div class="score-item">
                                <i class="fas fa-mouse-pointer" aria-hidden="true"></i>
                                <span>步数: <span id="bestMovesHard">--</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="game-footer" role="contentinfo">
            <p>2025 记忆翻牌游戏 | 使用纯HTML、CSS和JavaScript开发</p>
            <p class="instructions">游戏说明：点击卡片翻开，找出所有匹配的图案。尽量用最少的步数和时间完成游戏！</p>
        </footer>
    </div>

    <!-- 游戏胜利弹窗 -->
    <div class="win-modal" id="winModal" role="dialog" aria-labelledby="win-modal-title" aria-describedby="win-modal-description">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-trophy" aria-hidden="true"></i>
                <h2 id="win-modal-title">恭喜！游戏完成！</h2>
                <p id="win-modal-description" class="sr-only">游戏已完成，显示了您的时间、步数和匹配数</p>
            </div>
            <div class="modal-body">
                <div class="win-stats" role="list" aria-label="游戏完成统计数据">
                    <div class="win-stat" role="listitem">
                        <div class="win-stat-label">总时间</div>
                        <div class="win-stat-value" id="winTime" aria-live="polite">00:00</div>
                    </div>
                    <div class="win-stat" role="listitem">
                        <div class="win-stat-label">总步数</div>
                        <div class="win-stat-value" id="winMoves" aria-live="polite">0</div>
                    </div>
                    <div class="win-stat" role="listitem">
                        <div class="win-stat-label">匹配数</div>
                        <div class="win-stat-value" id="winMatches" aria-live="polite">0</div>
                    </div>
                </div>

                <div class="best-record" id="bestRecordMessage" role="status" aria-live="polite" aria-atomic="true">
                    <i class="fas fa-crown" aria-hidden="true"></i> 恭喜！创造了新的最佳记录！
                </div>

                <div class="modal-actions" aria-label="弹窗操作">
                    <button class="btn btn-play-again" id="playAgainBtn" aria-label="再来一局游戏">
                        <i class="fas fa-redo" aria-hidden="true"></i> 再来一局
                    </button>
                    <button class="btn btn-main-menu" id="mainMenuBtn" aria-label="返回游戏大厅主菜单">
                        <i class="fas fa-home" aria-hidden="true"></i> 返回主菜单
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="audio-manager.js"></script>
    <script src="game.js"></script>
</body>
</html>
