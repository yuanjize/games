<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>井字棋测试</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .test-container { max-width: 600px; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>井字棋游戏测试</h1>

        <div id="test1" class="test-result">
            <h3>测试 1: 文件存在性</h3>
            <p>正在检查必需的文件...</p>
        </div>

        <div id="test2" class="test-result">
            <h3>测试 2: 游戏初始化</h3>
            <p>正在初始化游戏...</p>
        </div>

        <div id="test3" class="test-result">
            <h3>测试 3: 棋盘渲染</h3>
            <p>正在渲染棋盘...</p>
        </div>

        <div id="test4" class="test-result">
            <h3>测试 4: AI逻辑</h3>
            <p>正在测试AI算法...</p>
        </div>

        <div id="test5" class="test-result">
            <h3>测试 5: 胜负判断</h3>
            <p>正在测试胜负逻辑...</p>
        </div>
    </div>

    <script>
        // 测试函数
        function runTests() {
            // 测试 1: 文件存在性
            const test1 = document.getElementById('test1');
            try {
                // 检查关键变量是否定义
                if (typeof GAME_CONFIG !== 'undefined' &&
                    typeof GAME_STATE !== 'undefined' &&
                    typeof MARKER !== 'undefined') {
                    test1.innerHTML = '<h3>✅ 测试 1: 文件存在性 - 通过</h3><p>游戏配置、状态和标记常量已正确定义。</p>';
                    test1.className = 'test-result pass';
                } else {
                    throw new Error('游戏常量未正确定义');
                }
            } catch (error) {
                test1.innerHTML = `<h3>❌ 测试 1: 文件存在性 - 失败</h3><p>错误: ${error.message}</p>`;
                test1.className = 'test-result fail';
            }

            // 测试 2: 游戏初始化
            const test2 = document.getElementById('test2');
            try {
                // 创建游戏实例
                const game = new TicTacToeGame();

                // 检查基本属性
                if (game.board &&
                    game.board.length === 3 &&
                    game.currentPlayer === 'X' &&
                    game.gameState === 'playing') {
                    test2.innerHTML = '<h3>✅ 测试 2: 游戏初始化 - 通过</h3><p>游戏实例已成功创建，初始状态正确。</p>';
                    test2.className = 'test-result pass';
                } else {
                    throw new Error('游戏初始化状态不正确');
                }
            } catch (error) {
                test2.innerHTML = `<h3>❌ 测试 2: 游戏初始化 - 失败</h3><p>错误: ${error.message}</p>`;
                test2.className = 'test-result fail';
            }

            // 测试 3: 棋盘渲染
            const test3 = document.getElementById('test3');
            try {
                const game = new TicTacToeGame();
                const board = document.createElement('div');
                board.id = 'test-board';
                document.body.appendChild(board);

                // 临时替换board元素进行测试
                const originalBoard = game.elements.board;
                game.elements.board = board;

                game.renderBoard();
                const cells = board.querySelectorAll('.cell');

                if (cells.length === 9) {
                    test3.innerHTML = '<h3>✅ 测试 3: 棋盘渲染 - 通过</h3><p>棋盘已成功渲染，9个格子正确创建。</p>';
                    test3.className = 'test-result pass';
                } else {
                    throw new Error(`棋盘渲染不正确，找到 ${cells.length} 个格子，预期 9 个`);
                }

                // 清理
                document.body.removeChild(board);
                game.elements.board = originalBoard;

            } catch (error) {
                test3.innerHTML = `<h3>❌ 测试 3: 棋盘渲染 - 失败</h3><p>错误: ${error.message}</p>`;
                test3.className = 'test-result fail';
            }

            // 测试 4: AI逻辑
            const test4 = document.getElementById('test4');
            try {
                const game = new TicTacToeGame();

                // 测试随机AI
                game.difficulty = 'easy';
                const easyMove = game.getRandomMove();
                if (easyMove && typeof easyMove.row === 'number' && typeof easyMove.col === 'number') {
                    // 测试中等AI
                    game.difficulty = 'medium';
                    const mediumMove = game.getMediumMove();

                    // 测试困难AI
                    game.difficulty = 'hard';
                    const hardMove = game.getHardMove();

                    test4.innerHTML = '<h3>✅ 测试 4: AI逻辑 - 通过</h3><p>所有AI难度级别均已实现并能生成有效走棋。</p>';
                    test4.className = 'test-result pass';
                } else {
                    throw new Error('AI走棋生成失败');
                }

            } catch (error) {
                test4.innerHTML = `<h3>❌ 测试 4: AI逻辑 - 失败</h3><p>错误: ${error.message}</p>`;
                test4.className = 'test-result fail';
            }

            // 测试 5: 胜负判断
            const test5 = document.getElementById('test5');
            try {
                const game = new TicTacToeGame();

                // 测试获胜检测
                const testBoard = [
                    ['X', 'X', 'X'],
                    ['', '', ''],
                    ['', '', '']
                ];

                // 临时替换棋盘
                const originalBoard = game.board;
                game.board = testBoard;

                const winner = game.checkWinner();
                const winLine = game.getWinningLine();

                if (winner === 'X' && winLine && winLine.type === 'row' && winLine.index === 0) {
                    test5.innerHTML = '<h3>✅ 测试 5: 胜负判断 - 通过</h3><p>胜负检测和获胜线路识别功能正常。</p>';
                    test5.className = 'test-result pass';
                } else {
                    throw new Error('胜负判断功能异常');
                }

                // 恢复棋盘
                game.board = originalBoard;

            } catch (error) {
                test5.innerHTML = `<h3>❌ 测试 5: 胜负判断 - 失败</h3><p>错误: ${error.message}</p>`;
                test5.className = 'test-result fail';
            }
        }

        // 加载游戏脚本后运行测试
        const script = document.createElement('script');
        script.src = 'game.js';
        script.onload = runTests;
        document.head.appendChild(script);
    </script>
</body>
</html>